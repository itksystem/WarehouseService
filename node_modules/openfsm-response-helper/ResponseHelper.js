const common = require("openfsm-common"); // Библиотека с общими параметрами
const logger = require('openfsm-logger-handler');
const CustomError = require('openfsm-custom-error');
const CommonFunctionHelper = require("openfsm-common-functions")

// Оберточный класс для Response
class ResponseHelper {
  constructor() {
    this.commonFunctionHelper = new CommonFunctionHelper();
  }

  send(res, code, data) {
    if (code >= 400)
      logger.error(data?.message || "Неизвестная ошибка");

    res.status(Number(code) || 500).json({
      code: data?.code || 500,
      message:
        data?.message ||
        this.commonFunctionHelper.getDescriptionByCode(500),
    });
  }

  error(req, res, error = null) {  
    let code = 500;
    let message =  error?.message || 'Неизвестная ошибка';
    if (error instanceof CustomError) {
      code = error.code ? error.code : code;
      message = error?.message;
    } 
    logger.error(error);
    res.status(code).json({code, message});
  };
}

module.exports = ResponseHelper;

